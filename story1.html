<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scal        // –î–æ–±–∞–≤–ª—è–µ–º MGID         // –î–æ–±–∞–≤–ª—è–µ–º MGID –≤–∏–¥–∂–µ—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω—É –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if (paragraphs.length > 4) {
          const middleIndex = Math.floor(paragraphs.length / 2);
          const middleParagraph = contentDiv.children[middleIndex];
          if (middleParagraph) {
            const mgidDiv = document.createElement('div');
            mgidDiv.className = 'mgid-container';
            mgidDiv.innerHTML = `
              <div class="mgid-header">
                <span class="mgid-icon">üì∞</span>
                <span class="mgid-title">–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ</span>
              </div>
              <div class="mgid-content">
                <div data-type="_mgwidget" data-widget-id="1828363"></div>
                <script>(function(w,q){w[q]=w[q]||[];w[q].push(["_mgc.load"])})(window,"_mgq");</script>
              </div>
            `;
            middleParagraph.insertAdjacentElement('afterend', mgidDiv);
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const script = mgidDiv.querySelector('script');
            if (script) {
              const newScript = document.createElement('script');
              newScript.textContent = script.textContent;
              document.body.appendChild(newScript);
            }
          }
        }–Ω—É –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if (paragraphs.length > 4) {
          const middleIndex = Math.floor(paragraphs.length / 2);
          const middleParagraph = contentDiv.children[middleIndex];
          if (middleParagraph) {
            const mgidDiv = document.createElement('div');
            mgidDiv.className = 'mgid-container';
            mgidDiv.innerHTML = `
              <div class="mgid-header">
                <span class="mgid-icon">üì∞</span>
                <span class="mgid-title">–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ</span>
              </div>
              <div class="mgid-content">
                <div data-type="_mgwidget" data-widget-id="1828363"></div>
                <script>(function(w,q){w[q]=w[q]||[];w[q].push(["_mgc.load"])})(window,"_mgq");</script>
              </div>
            `;
            middleParagraph.insertAdjacentElement('afterend', mgidDiv);
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const script = mgidDiv.querySelector('script');
            if (script) {
              const newScript = document.createElement('script');
              newScript.textContent = script.textContent;
              document.body.appendChild(newScript);
            }
          }
        }>–°–æ–æ–±—â–µ—Å—Ç–≤–æ –ò—Å—Ç–æ—Ä–∏–π</title>

  <!-- –í–∞—à–∏ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="styles.css">

  <!-- Google Analytics -->
  <script src="analytics.js"></script>

  <!-- MGID –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç - –¢–û–ß–ù–û –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->  
  <script src="https://jsc.mgid.com/site/1042649.js" async></script>

  <!-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –∏—Å—Ç–æ—Ä–∏–π -->
  <script src="optimized-loader.js"></script>

  <!-- Favicon –∏ Apple-touch-icon -->
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="index.html" class="logo">‚Üê –ù–∞–∑–∞–¥</a>
      <button class="menu-toggle" aria-label="Toggle menu">
        <svg viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
      </button>
      <nav class="main-nav">
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="about.html">–û –Ω–∞—Å</a>
        <a href="contact.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>
    </div>
  </header>

  <div class="reading-progress" id="progress"></div>

  <div class="container">
    <div id="story-container">
      <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ -->
    </div>

    <!-- MGID Widget –ø–æ—Å–ª–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
    <div class="mgid-container">
      <div class="mgid-header">
        <span class="mgid-icon">üìñ</span>
        <span class="mgid-title">–ü–æ—Ö–æ–∂–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</span>
      </div>
      <div class="mgid-content">
        <div data-type="_mgwidget" data-widget-id="1828363"></div>
        <script>(function(w,q){w[q]=w[q]||[];w[q].push(["_mgc.load"])})(window,"_mgq");</script>
      </div>
    </div>

    <div id="recommendations" class="recommendations" style="display:none">
      <!-- –ó–¥–µ—Å—å ‚Äî –±–ª–æ–∫ ¬´–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ¬ª -->
    </div>

    <!-- MGID Widget –≤–Ω–∏–∑—É -->
    <div class="mgid-container">
      <div class="mgid-header">
        <span class="mgid-icon">‚≠ê</span>
        <span class="mgid-title">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å</span>
      </div>
      <div class="mgid-content">
        <div data-type="_mgwidget" data-widget-id="1828363"></div>
        <script>(function(w,q){w[q]=w[q]||[];w[q].push(["_mgc.load"])})(window,"_mgq");</script>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">¬© 2025 –°–æ–æ–±—â–µ—Å—Ç–≤–æ –ò—Å—Ç–æ—Ä–∏–π</div>
  </footer>

  <script>
    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á—Ç–µ–Ω–∏—è
    document.addEventListener('scroll', () => {
      const prog = document.getElementById('progress');
      const height = document.documentElement.scrollHeight - window.innerHeight;
      prog.style.width = height
        ? (window.scrollY / height * 100) + '%'
        : '0';
    });

    document.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('story-container');
      const recContainer = document.getElementById('recommendations');
      const id = new URLSearchParams(window.location.search).get('id');
      if (!id) {
        container.innerHTML = '<p>–ù–µ —É–∫–∞–∑–∞–Ω ID –∏—Å—Ç–æ—Ä–∏–∏.</p>';
        return;
      }

      try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é...</div>';

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫
        const story = await window.storyLoader.findStoryById(id);
        
        if (!story) {
          container.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</p>';
          return;
        }

        const pageUrl = encodeURIComponent(window.location.href);
        const paragraphs = story.content.split(/\r?\n/).filter(p => p.trim() !== '');

        // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã
        container.innerHTML = `
          <article class="story-detail">
            <h1 class="story-title">${story.title}</h1>
            <img src="${story.image}" alt="${story.title}" class="story-image">
            <div class="story-meta">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: ${story.views}</div>
            <div class="story-content"></div>
            <div class="btn-group">
              <a href="index.html" class="btn return-btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
              <a href="https://www.facebook.com/sharer/sharer.php?u=${pageUrl}"
                 target="_blank" class="btn share-btn">
                –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π
              </a>
            </div>
          </article>
        `;

        const contentDiv = container.querySelector('.story-content');
        paragraphs.forEach(p => {
          contentDiv.insertAdjacentHTML('beforeend', `<p>${p}</p>`);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º MGID –≤–∏–¥–∂–µ—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω—É –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if (paragraphs.length > 4) {
          const middleIndex = Math.floor(paragraphs.length / 2);
          const middleParagraph = contentDiv.children[middleIndex];
          if (middleParagraph) {
            const mgidDiv = document.createElement('div');
            mgidDiv.id = 'mgid-in-content';
            middleParagraph.insertAdjacentElement('afterend', mgidDiv);
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
              window.mgid.createWidget('mgid-in-content', 'ÔøΩ –ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ');
            }, 1500);
          }
        }

        // –ë–ª–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        const randomStories = await window.storyLoader.getRandomStories(5);
        const others = randomStories.filter(item => String(item.id) !== id);
        
        recContainer.innerHTML = '<h3>–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ</h3><ul>' +
          others.map(o =>
            `<li><a href="story1.html?id=${o.id}">${o.title}</a></li>`
          ).join('') +
          '</ul>';
        recContainer.style.display = 'block';

        console.log('–ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞, MGID –≤–∏–¥–∂–µ—Ç—ã —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ HTML');

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
        container.innerHTML = '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é.</p>';
      }

      // Toggle –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
      document.querySelector('.menu-toggle')
        .addEventListener('click', () => {
          document.querySelector('.main-nav').classList.toggle('open');
        });
    });
  </script>

  <!-- –í–∞—à–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="comments.js"></script>
</body>
</html>
