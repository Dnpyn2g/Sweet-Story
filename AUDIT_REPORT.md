# Sweet Story – Результаты аудита (2025-08-21)

## 1. Найденные проблемы (до исправлений)
- Отсутствовали `robots.txt` и `sitemap.xml`.
- На главной и странице истории не было статического `<meta name="description">` при первичной загрузке (динамика добавлялась позже, но Google может индексировать до выполнения JS).
- Нет `font-display: swap` (добавлено через параметр Google Fonts). Возможны FOUT/FOIT.
- Несколько изображений без явных размеров → риск CLS.
- Отсутствовали skip‑link и ARIA-метки для основного контента.
- Дубли CSS (два больших файла `styles.css` и `st.css`) с пересекающимися блоками и разными цветами / градиентами.
- Нет ленивой загрузки (`loading="lazy"`) у большинства картинок.
- Скрипты блокировали парсинг (`optimized-loader.js`, `google-analytics.js`, `sidebar.js`).
- Нет долгосрочных HTTP cache заголовков (нужно настроить на сервере: `Cache-Control` + хэширование имен).
- Нет минификации CSS/JS (рекомендуется build шаг).
- `ads.txt` содержит дубликаты и строки с лишними кавычками.
- Несогласованные пути к стилям (`privacy.html` ссылался на `css/styles.css`).
- Контраст некоторых вторичных текстов (#777 на #f9f9f9) пограничный (WCAG AA для малого текста >= 4.5:1).
- Нет структурированных данных Article на странице истории до выполнения JS.
- Отсутствуют alt уточнения и единообразие для декоративных SVG.
- Потенциальный TBT рост из-за объема инлайновых JS и повторяющегося кода баннера.

## 2. Выполненные правки
- Добавлены `robots.txt` и `sitemap.xml` (базовые URL; расширяйте при добавлении страниц).
- Улучшены `<title>` и `<meta description>` в `index.html`, `story1.html`, `privacy.html`.
- Добавлены OG/Twitter fallback теги для ключевых страниц.
- Добавлен `link rel=canonical`.
- Скрипты переведены на `defer` (где безопасно) для снижения блокировки рендеринга.
- Добавлен preload критического CSS и шрифта.
- Изображения в карточках и истории получили `loading="lazy"`, `decoding="async"`, размеры.
- Добавлен skip-link и ARIA-атрибуты на главной.
- Добавлена динамическая вставка Article Schema + улучшенный SEO для истории (через `applyStorySEO`).
- Повышен контраст `.story-excerpt`.
- Добавлены улучшения типографики (font smoothing) и производительности.
- Исправлен неверный путь к CSS в `privacy.html`.
- Очищен и нормализован `ads.txt` (удалены дубли и кавычки / проблемы формата).
- Добавлены стили видимого `:focus` (accessibility) для ссылок, кнопок, skip-link.
- Вынесен повторяющийся inline-код баннера в модуль `banner.js` (DRY, снижение TBT/размер HTML).
- Подключение баннера теперь через внешний скрипт с `defer`.

## 3. Файлы, изменённые или добавленные
- `index.html` (SEO, lazyload, defer, структура, удалён inline баннер, добавлен banner.js)
- `story1.html` (SEO, schema, accessibility, lazyload, удалён inline баннер)
- `privacy.html` (правильный путь стилей, мета теги)
- `styles.css` (контраст, focus стили)
- `st.css` (focus стили)
- `banner.js` (новый модуль управления баннером)
- `ads.txt` (очистка и нормализация)
- Добавлены ранее: `robots.txt`, `sitemap.xml`, `AUDIT_REPORT.md`

## 4. Рекомендации для дальнейшей оптимизации
### Lighthouse / Web Vitals
1. LCP: 
   - Вынести критический Above-the-fold CSS (выделить стили header + первые карточки в inline `<style>` ~8–12KB) и отложить остальное через `media="print" onload` паттерн.
   - Рассмотреть генерацию уменьшенных превью (blur-up / LQIP) для карточек.
2. CLS:
   - Явно задавать `width/height` или `aspect-ratio` для всех `<img>` и контейнеров рекламных виджетов (добавить inline стиль высоты-заглушки под рекламу).
3. TBT/INP:
   - Разбить длинные синхронные участки JS (класс баннера + логика рендера) на микрозадачи `requestIdleCallback` / `setTimeout(0)`.
   - Удалить дубли анимаций или вынести повторяющиеся функции.
4. Network:
   - Включить на сервере: `Cache-Control: public, max-age=31536000, immutable` для версиированных статик файлов; добавить хэши в имена (build step).
   - Включить `gzip` или `brotli` компрессию.

### Изображения
- Проверить реальный размер отображения карточек; сгенерировать responsive набор (`<img srcset>` или `<picture>` + `type="image/avif"`).
- Конвертировать крупные PNG/JPG в AVIF/WebP (если ещё остались кроме .webp). Автоматизировать (например, Sharp / Squoosh CI step).

### CSS/JS
- Объединить похожие стили из `styles.css` и `st.css`; провести purge (PurgeCSS / LightningCSS) для удаления неиспользуемых селекторов.
- Минифицировать результаты (esbuild / lightningcss) и создать версиированные файлы: `styles.abcd1234.css`.
- Вынести инлайн-скрипты баннера и повторный код в модуль (DRY).
- Добавить `type="module"` для авторского кода и использовать динамический импорт для тяжёлых модулей (например, комментарии загружать по `IntersectionObserver`).

### SEO
- Генерировать динамический `sitemap.xml` с перечнем всех историй (каждая история как отдельный URL: `/story1.html?id=ID` лучше заменить на человеко‑понятные URL `/stories/ID-slug` для чистоты и возможности указать `<loc>` напрямую).
- Добавить `hreflang` если планируется мультиязычность.
- Добавить `lastmod` для `sitemap.xml`.
- Устранить дубликаты между `about.html` и `contact.html` (в contact есть блоки с About — унифицировать).

### Accessibility
- Проверить контраст остальных элементов (кнопки баннера поверх градиента). Возможна необходимость затемнить фон или усилить белый текст (добавить `text-shadow` уже частично есть).
- Добавить `aria-label` для кнопки закрытия баннера.
- Обеспечить фокусируемость skip-link при tab (CSS: `.skip-link:focus { left: 8px; top:8px; width:auto; height:auto; clip:auto;}` ).
- У всех интерактивных элементов обеспечить видимый `:focus` стиль.

### Безопасность / Надёжность
- CSP заголовок (script-src 'self' https://jsc.mgid.com https://www.googletagmanager.com). Добавить `upgrade-insecure-requests`.
- SRI для внешних скриптов где возможно.

### Мониторинг
- Подключить Web Vitals reporting (либо отправка в GA4: `web-vitals` npm пакет) для реальных пользователей.

### ads.txt
- Периодически сверять с актуальными партнёрами; поддерживать отсортированным.

## 5. Что можно поправить вручную
- Полная ревизия `ads.txt`.
- Консолидация двух CSS файлов и удаление неиспользуемых правил.
- Реализация человеко-понятных URL историй и генерация динамических страниц (SSR/Static build).
- Расширение sitemap с историями.
- Добавление preload для hero изображения (если нужно улучшить LCP) и внедрение `fetchpriority="high"` для него.
- (СДЕЛАНО) Вынести inline JS баннера в модуль (`banner.js`).
- Добавить ленивую загрузку комментариев (доп. оптимизация) — потенциально через IntersectionObserver.

---
Отчёт сформирован автоматически. Для уточнений и следующих шагов можно запросить детальный план внедрения build-пайплайна.
